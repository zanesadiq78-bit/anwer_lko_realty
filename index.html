<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anwer Sadiq's Realty</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a sophisticated look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50; /* A deep, professional blue-gray */
            --accent-color: #f39c12; /* A warm, inviting gold */
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7f6;
            color: #333;
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        .page-section {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        .bg-primary {
            background-color: var(--primary-color);
        }
        .text-primary {
            color: var(--primary-color);
        }
        .bg-accent {
            background-color: var(--accent-color);
        }
        .hover-bg-accent:hover {
            background-color: #e67e22; /* A slightly darker orange for hover */
        }
        .loader {
            border-top-color: var(--accent-color);
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="pt-16">
    <!-- Navigation Bar -->
    <nav id="navbar" class="fixed top-0 left-0 w-full bg-white bg-opacity-95 backdrop-blur-sm shadow-lg z-20 hidden">
        <div class="container mx-auto flex items-center justify-between py-4 px-8">
            <!-- Logo/Brand -->
            <div class="bg-accent rounded-full w-8 h-8 flex items-center justify-center text-white font-bold">A</div>
            <!-- Nav Links -->
            <div class="flex space-x-6">
                <a href="#" id="nav-home" class="text-gray-700 hover:text-accent transition-colors duration-300 font-medium">Home</a>
                <a href="#" id="nav-areas" class="text-gray-700 hover:text-accent transition-colors duration-300 font-medium">Areas</a>
                <a href="#" id="nav-logout" class="text-gray-700 hover:text-accent transition-colors duration-300 font-medium">Logout</a>
            </div>
        </div>
    </nav>
    <!-- Main Application Container -->
    <div id="app" class="min-h-screen flex flex-col items-center justify-center">

        <!-- Login Section -->
        <div id="login-section" class="page-section bg-white p-10 rounded-3xl shadow-2xl w-full max-w-md transform transition-all duration-500 scale-100">
            <h2 class="text-4xl font-bold text-center text-primary mb-8">Welcome</h2>
            <div class="relative w-full mb-6">
                <input id="password-input" type="password" class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary placeholder-gray-400" placeholder="Enter password">
            </div>
            <button id="login-button" class="w-full bg-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity duration-300 shadow-lg">
                Sign In
            </button>
            <p id="login-message" class="text-center text-red-500 font-medium mt-4"></p>
        </div>

        <!-- Home Section -->
        <div id="home-section" class="page-section w-full">
            <!-- Hero Section -->
            <header class="relative w-full h-screen flex flex-col items-center justify-center text-white text-center p-8 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1600585154340-97500587780a?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');">
                <div class="absolute inset-0 bg-primary bg-opacity-70"></div>
                <div class="relative z-10 max-w-4xl mx-auto">
                    <h1 id="dad-name" class="text-5xl md:text-7xl font-extrabold leading-tight mb-4 text-accent">
                        ANWER SADIQ'S REALTY
                    </h1>
                    <p class="text-lg md:text-xl font-light mb-10">
                        A curated showcase of premier properties, meticulously selected for their distinction and value.
                    </p>
                    <button id="explore-button" class="bg-accent text-primary text-lg font-semibold px-10 py-4 rounded-full hover-bg-accent transition-colors duration-300 shadow-xl transform hover:scale-105">
                        Explore Now
                    </button>
                </div>
            </header>
        </div>

        <!-- Areas Section -->
        <div id="areas-section" class="page-section w-full max-w-6xl mx-auto py-20 px-8 bg-blue-100">
            <h2 class="text-4xl font-bold text-center text-primary mb-16">Explore Our Areas</h2>
            <div id="areas-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 w-full">
                <!-- Area cards will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Properties Section -->
        <div id="properties-section" class="page-section w-full max-w-6xl mx-auto py-20 px-8 bg-blue-100">
            <div class="flex items-center mb-10">
                <button id="back-to-areas" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-full hover:bg-gray-300 transition-colors duration-300 transform hover:scale-105">
                    &larr; Back
                </button>
                <h2 id="properties-area-title" class="text-4xl font-bold text-primary ml-4">Properties</h2>
            </div>
            <div id="properties-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 w-full">
                <!-- Property cards will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Property Details Section -->
        <div id="details-section" class="page-section w-full max-w-7xl mx-auto py-20 px-8">
            <button id="back-to-properties" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-full hover:bg-gray-300 transition-colors duration-300 transform hover:scale-105 mb-8">
                &larr; Back
            </button>
            <div id="details-content" class="bg-white p-10 rounded-3xl shadow-2xl w-full">
                <!-- Property details will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-50 bg-opacity-75 z-50">
            <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24"></div>
        </div>
    </div>
    
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, getDocs, getDoc, doc, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: The following global variables are provided by the canvas environment.
        // DO NOT remove or modify them.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' && typeof __firebase_config === 'string' ? JSON.parse(__firebase_config) : {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };
        const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Mock data for local development
        const MOCK_PROPERTIES = [
            {
                area: 'Aminabad',
                name: 'Shop No. 401',
                location: '401 Main Bazaar, Aminabad',
                dimensions: '100 sq ft',
                images: [
                    'https://content.jdmagicbox.com/comp/lucknow/c2/0522px522.x522.171012182226.v5c2/catalogue/wahid-biryani-lucknow-pl86i.jpg'
                ],
                other_details: {
                    type: 'Retail Shop',
                    status: 'vacant',
                }
            },
            {
                area: 'Aminabad',
                name: 'Shop No. 402',
                location: '402 Main Bazaar, Aminabad',
                dimensions: '150 sq ft',
                images: [
                    'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj26B-laUIWVx_qyUp2qF66vfdJDnL16_-oZsAaKqQctJp7VMYB-wF0t1Lf1u_HOZhQIE09gBWrZ9-4vndUypWi36VNaCdrSUZpZTfPaFcYD5FDCNMB0W4H7rsUuZ3stJlR9DbPu5mTRkoj/s1600/13781729_1222710774428574_764609903607950642_n.jpg'
                ],
                other_details: {
                    type: 'Retail Shop',
                    status: 'vacant',
                }
            },
            {
                area: 'Aminabad',
                name: 'Shop No. 403',
                location: '403 Main Bazaar, Aminabad',
                dimensions: '120 sq ft',
                images: [
                    'https://www.nowlucknow.com/wp-content/uploads/2018/04/Karamat-1-1024x683.jpg'
                ],
                other_details: {
                    type: 'Retail Shop',
                    status: 'vacant',
                }
            },
            {
                area: 'Aminabad',
                name: 'Shop No. 404',
                location: '404 Main Bazaar, Aminabad',
                dimensions: '180 sq ft',
                images: [
                    'https://content.jdmagicbox.com/v2/comp/delhi/84/011pg025984/catalogue/new-gaurav-watch-co-lajpat-nagar-2-delhi-wrist-watch-repair-and-services-sv2p2zo44o.jpg'
                ],
                other_details: {
                    type: 'Retail Shop',
                    status: 'vacant',
                }
            },
            {
                area: 'Malak',
                name: 'Khasra No. 9666',
                location: '789 Pine Road, Lakeside',
                dimensions: '1,500 sq ft',
                images: [
                    'https://5.imimg.com/data5/SELLER/Default/2022/6/PY/XW/GM/143012748/9d46f98d-0ac3-43e9-9687-ceaefe0c2e5a-500x500.jpg'
                ],
                other_details: {
                    bedrooms: 2,
                    bathrooms: 1,
                    amenities: 'Private dock, Fire pit',
                }
            },
            {
                area: 'Malak',
                name: 'Khasra No. 9667',
                location: '101 Oak Lane, The Countryside',
                dimensions: '3,000 sq ft',
                images: [
                    'https://rei.wlimg.com/prop_images/2468809/1152018_2.jpg',
                    'https://images.unsplash.com/photo-1508738362670-65476a6d6349?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                ],
                other_details: {
                    bedrooms: 4,
                    bathrooms: 2,
                    amenities: 'Large garden, Barn, Ample parking',
                }
            },
            {
                area: 'Malak',
                name: 'Khasra No. 9665',
                location: '123 Forest View, Malak',
                dimensions: '1,800 sq ft',
                images: [
                    'https://housing-images.n7net.in/01c16c28/7f5cd1af1e09e584ae20e8f6aca7d607/v0/medium/residential_plot-for-sale-lakshvar_vajaha-Lucknow-plot_view.jpg'
                ],
                other_details: {
                    bedrooms: 3,
                    bathrooms: 2,
                    amenities: 'Large lot, Private garden',
                }
            },
            {
                area: 'Sarojini Nagar',
                name: 'Near Neem Ka Ped',
                location: '404 Ocean Drive, Sunny Shores',
                dimensions: '1,200 sq ft',
                images: [
                    'https://i0.wp.com/solarvillageproject.org/wp-content/uploads/2023/03/scroling-pic2-9-scaled.jpg?ssl=1',
                    'https://images.unsplash.com/photo-1588698943797-17e9447387c2?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                ],
                other_details: {
                    bedrooms: 2,
                    bathrooms: 2,
                    amenities: 'Direct beach access, Patio, Fully furnished',
                }
            },
             {
                area: 'Sarojini Nagar',
                name: 'Near Aam Ka Pedh',
                location: '123 Pinecrest Lane, Mountainville',
                dimensions: '1,000 sq ft',
                images: [
                    'https://i0.wp.com/solarvillageproject.org/wp-content/uploads/2023/03/scroling-pic2-9-scaled.jpg?ssl=1',
                    'https://images.unsplash.com/photo-1528659837941-865611736b72?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                ],
                other_details: {
                    bedrooms: 2,
                    bathrooms: 1,
                    amenities: 'Scenic views, Fireplace, Hot tub',
                }
            },
        ];

        // Function to set up Firebase and authenticate
        const setupFirebase = async () => {
            console.log("Starting Firebase setup...");
            // Check if we are running locally with a placeholder config
            if (firebaseConfig.projectId === "your-project-id") {
                console.log("Running in local mock mode. Firebase is not connected.");
                // Return a mock object instead of a real connection
                return {
                    db: {
                        collection: (path) => ({}),
                        getDocs: async () => ({
                            empty: MOCK_PROPERTIES.length === 0,
                            forEach: (callback) => {
                                MOCK_PROPERTIES.forEach(item => callback({ id: Math.random().toString(), data: () => item }));
                            }
                        })
                    },
                    auth: {
                        currentUser: {
                            uid: 'mock-user-id'
                        }
                    }
                };
            }

            // Otherwise, proceed with real Firebase setup
            setLogLevel('debug');
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // Use the provided auth token for authentication
            try {
                if (authToken) {
                    await signInWithCustomToken(auth, authToken);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase authenticated successfully.");
                return { db, auth };
            } catch (error) {
                console.error("Firebase authentication failed:", error);
                return null;
            }
        };

        // DOM elements
        const loginSection = document.getElementById('login-section');
        const homeSection = document.getElementById('home-section');
        const areasSection = document.getElementById('areas-section');
        const propertiesSection = document.getElementById('properties-section');
        const detailsSection = document.getElementById('details-section');
        const loadingIndicator = document.getElementById('loading-indicator');
        const exploreButton = document.getElementById('explore-button');
        const areasContainer = document.getElementById('areas-container');
        const propertiesContainer = document.getElementById('properties-container');
        const backToAreasButton = document.getElementById('back-to-areas');
        const backToPropertiesButton = document.getElementById('back-to-properties');
        const propertiesAreaTitle = document.getElementById('properties-area-title');
        const detailsContent = document.getElementById('details-content');
        const loginButton = document.getElementById('login-button');
        const passwordInput = document.getElementById('password-input');
        const loginMessage = document.getElementById('login-message');
        const navbar = document.getElementById('navbar');
        const navHome = document.getElementById('nav-home');
        const navAreas = document.getElementById('nav-areas');
        const navLogout = document.getElementById('nav-logout');

        // Hardcoded password for this simple example. You should change this.
        const SECRET_PASSWORD = "my-secret-password";

        // Global variables
        let db;
        let auth;
        let allProperties = [];

        // Function to show or hide the navbar
        const toggleNavbar = (show) => {
            if (show) {
                navbar.classList.remove('hidden');
            } else {
                navbar.classList.add('hidden');
            }
        };

        // Function to switch between pages
        const showPage = (pageId) => {
            const sections = [loginSection, homeSection, areasSection, propertiesSection, detailsSection];
            sections.forEach(section => {
                const isCurrentPage = section.id === pageId;
                section.style.display = isCurrentPage ? 'flex' : 'none';
                if (isCurrentPage) {
                    section.classList.remove('opacity-0', 'scale-95');
                    section.classList.add('opacity-100', 'scale-100');
                } else {
                    section.classList.remove('opacity-100', 'scale-100');
                    section.classList.add('opacity-0', 'scale-95');
                }
            });
            // Show navbar only after successful login
            if (pageId !== 'login-section') {
                toggleNavbar(true);
            } else {
                toggleNavbar(false);
            }
        };

        // Function to fetch data from Firestore
        const fetchData = async () => {
            console.log("Fetching data from Firestore...");
            loadingIndicator.style.display = 'flex';
            try {
                // Check if the app is in mock mode (not a real database)
                if (firebaseConfig.projectId === "your-project-id") {
                    console.log("Using mock data.");
                    allProperties = MOCK_PROPERTIES;
                } else {
                    console.log("Using real Firestore database.");
                    const propertiesCollectionRef = collection(db, `artifacts/${appId}/public/data/properties`);
                    const q = query(propertiesCollectionRef);
                    const querySnapshot = await getDocs(q);
                    allProperties = [];
                    querySnapshot.forEach((doc) => {
                        allProperties.push({ id: doc.id, ...doc.data() });
                    });
                }
                
                console.log("Successfully fetched", allProperties.length, "properties.");
                console.log("All properties:", allProperties);
            } catch (error) {
                console.error("Error fetching documents:", error);
            } finally {
                loadingIndicator.style.display = 'none';
            }
        };

        // Function to render areas
        const renderAreas = () => {
            console.log("Rendering areas from properties:", allProperties);
            const areas = [...new Set(allProperties.map(p => p.area))];
            areasContainer.innerHTML = '';
            areas.forEach(area => {
                let imageUrl = 'https://placehold.co/800x450/e2e8f0/4a5568?text=Area+Image'; // Default placeholder
                if (area === 'Aminabad') {
                    // Using the new direct image URL
                    imageUrl = 'https://www.shutterstock.com/image-photo/lucknow-india-may-06-2019-600nw-1440227564.jpg';
                } else if (area === 'Malak') {
                    imageUrl = 'https://rei.wlimg.com/prop_images/2468809/1152018_2.jpg';
                } else if (area === 'Sarojini Nagar') {
                    imageUrl = 'https://i0.wp.com/solarvillageproject.org/wp-content/uploads/2023/03/scroling-pic2-9-scaled.jpg?ssl=1';
                }

                const areaCard = document.createElement('div');
                areaCard.className = 'bg-white flex flex-col items-center p-0 rounded-2xl shadow-lg cursor-pointer hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden';
                areaCard.innerHTML = `
                    <img src="${imageUrl}" alt="${area}" class="w-full h-48 object-cover">
                    <div class="py-6 px-4 w-full">
                        <h3 class="text-xl font-semibold text-primary text-center">${area}</h3>
                    </div>
                `;
                areaCard.addEventListener('click', () => {
                    renderProperties(area);
                });
                areasContainer.appendChild(areaCard);
            });
            showPage('areas-section');
        };

        // Function to render properties for a given area
        const renderProperties = (area) => {
            const propertiesInArea = allProperties.filter(p => p.area === area);
            propertiesAreaTitle.textContent = `Properties in ${area}`;
            propertiesContainer.innerHTML = '';
            propertiesInArea.forEach(property => {
                const propertyCard = document.createElement('div');
                propertyCard.className = 'bg-white p-6 rounded-2xl shadow-lg cursor-pointer hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2';
                const firstImage = property.images && property.images.length > 0 ? property.images[0] : 'https://placehold.co/800x450/e2e8f0/4a5568?text=No+Image';
                propertyCard.innerHTML = `
                    <img src="${firstImage}" alt="${property.name}" class="w-full h-52 object-cover rounded-xl mb-4 shadow-md">
                    <h3 class="text-xl font-bold text-primary mb-2">${property.name}</h3>
                    <p class="text-sm text-gray-500">${property.location}</p>
                `;
                propertyCard.addEventListener('click', () => {
                    renderDetails(property);
                });
                propertiesContainer.appendChild(propertyCard);
            });
            showPage('properties-section');
        };

        // Function to render a single property's details
        const renderDetails = (property) => {
            let imagesHtml = '';
            if (property.images && property.images.length > 0) {
                imagesHtml = `<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">` + property.images.map(img => `<img src="${img}" class="w-full h-auto object-cover rounded-xl shadow-md" alt="Property image">`).join('') + `</div>`;
            } else {
                imagesHtml = `<img src="https://placehold.co/800x450/e2e8f0/4a5568?text=No+Images" class="w-full h-auto object-cover rounded-xl shadow-md mb-8" alt="No images available">`;
            }
            
            let detailsHtml = '';
            for (const key in property.other_details) {
                if (Object.hasOwnProperty.call(property.other_details, key)) {
                    detailsHtml += `<p class="text-lg text-gray-600 mb-3"><strong class="font-semibold capitalize text-primary">${key.replace(/_/g, ' ')}:</strong> ${property.other_details[key]}</p>`;
                }
            }

            detailsContent.innerHTML = `
                <h3 class="text-4xl font-bold text-primary mb-4">${property.name}</h3>
                <p class="text-xl text-gray-600 mb-6 font-medium"><strong>Location:</strong> ${property.location}</p>
                <p class="text-xl text-gray-600 mb-6 font-medium"><strong>Dimensions:</strong> ${property.dimensions}</p>
                <div class="mb-8">
                    <h4 class="text-2xl font-bold mb-4 text-primary">Gallery</h4>
                    ${imagesHtml}
                </div>
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-primary">Other Details</h4>
                    ${detailsHtml}
                </div>
                <!-- AI-Powered Description Section -->
                <div class="mb-8 p-6 bg-gray-100 rounded-2xl shadow-inner">
                    <div class="flex items-center justify-between mb-4">
                         <h4 class="text-2xl font-bold text-primary">Property Description</h4>
                         <button id="generate-description-btn" class="bg-accent text-primary font-semibold px-6 py-2 rounded-full hover:opacity-90 transition-opacity duration-300 transform hover:scale-105">
                             Generate Description âœ¨
                         </button>
                    </div>
                    <div id="ai-description" class="text-gray-700 text-lg leading-relaxed">
                        <p>Click the button above to generate a professional, AI-powered description for this property.</p>
                    </div>
                    <div id="ai-loading-spinner" class="hidden mt-4 flex justify-center items-center">
                        <div class="loader w-8 h-8"></div>
                    </div>
                </div>
            `;
            
            // Add event listener for the new button
            const generateBtn = document.getElementById('generate-description-btn');
            generateBtn.addEventListener('click', () => generatePropertyDescription(property));

            showPage('details-section');
        };

        // Function to generate a description using the Gemini API
        const generatePropertyDescription = async (property) => {
            const aiDescriptionDiv = document.getElementById('ai-description');
            const aiLoadingSpinner = document.getElementById('ai-loading-spinner');
            const generateBtn = document.getElementById('generate-description-btn');
            
            aiDescriptionDiv.innerHTML = '';
            aiLoadingSpinner.classList.remove('hidden');
            generateBtn.disabled = true;

            const prompt = `Write a professional and compelling real estate listing description for the following property. Focus on elegance, comfort, and value. The description should be a single paragraph.

            Property details:
            - Name: ${property.name}
            - Location: ${property.location}
            - Dimensions: ${property.dimensions}
            - Other details: ${JSON.stringify(property.other_details)}
            
            Start the description with the property name.`;
            
            // API payload
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: "You are a world-class real estate copywriter. Write elegant and descriptive property summaries." }]
                },
            };
            
            const apiKey = ""; // Canvas will provide this at runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let resultText = '';

            try {
                let retries = 0;
                const maxRetries = 3;
                while (retries < maxRetries) {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        resultText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        break; // Exit the loop on success
                    } else if (response.status === 429) {
                        // Handle rate limiting with exponential backoff
                        retries++;
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        console.log(`Retrying API call... Attempt ${retries}`);
                    } else {
                        throw new Error(`API returned status code ${response.status}`);
                    }
                }

                if (resultText) {
                    aiDescriptionDiv.textContent = resultText;
                } else {
                    aiDescriptionDiv.textContent = "Could not generate description. Please try again.";
                    console.error("API response missing text content.");
                }

            } catch (error) {
                aiDescriptionDiv.textContent = "An error occurred while generating the description.";
                console.error("Error calling Gemini API:", error);
            } finally {
                aiLoadingSpinner.classList.add('hidden');
                generateBtn.disabled = false;
            }
        };

        // Event Listeners
        window.onload = async () => {
            const firebase = await setupFirebase();
            if (firebase) {
                db = firebase.db;
                auth = firebase.auth;
                
                // Add initial placeholder data if the collection is empty and not in mock mode
                if (firebaseConfig.projectId !== "your-project-id") {
                    console.log("Checking for placeholder data...");
                    await addPlaceholderData();
                }

                await fetchData();
                showPage('login-section');
            } else {
                loginMessage.textContent = "Error: Firebase setup failed. Check console for details.";
                showPage('login-section');
            }
        };

        loginButton.addEventListener('click', async () => {
            const password = passwordInput.value;
            if (password === SECRET_PASSWORD) {
                loginMessage.textContent = "Logged in successfully!";
                await fetchData();
                showPage('home-section');
            } else {
                loginMessage.textContent = "Incorrect password. Please try again.";
            }
        });

        exploreButton.addEventListener('click', () => {
            renderAreas();
        });

        backToAreasButton.addEventListener('click', () => {
            showPage('areas-section');
        });

        backToPropertiesButton.addEventListener('click', () => {
            showPage('properties-section');
        });

        navHome.addEventListener('click', () => {
            showPage('home-section');
        });

        navAreas.addEventListener('click', () => {
            renderAreas();
        });

        navLogout.addEventListener('click', () => {
            showPage('login-section');
        });
        
        // Function to add placeholder data to the database
        const addPlaceholderData = async () => {
            try {
                if (firebaseConfig.projectId !== "your-project-id") {
                    const collectionRef = collection(db, `artifacts/${appId}/public/data/properties`);
                    const snapshot = await getDocs(collectionRef);
                    
                    if (snapshot.empty) {
                        console.log("Placeholder data collection is empty. Adding data now...");
                        const properties = [
                            {
                                area: 'Aminabad',
                                name: 'Shop No. 401',
                                location: '401 Main Bazaar, Aminabad',
                                dimensions: '100 sq ft',
                                images: [
                                    'https://content.jdmagicbox.com/comp/lucknow/c2/0522px522.x522.171012182226.v5c2/catalogue/wahid-biryani-lucknow-pl86i.jpg'
                                ],
                                other_details: {
                                    type: 'Retail Shop',
                                    status: 'vacant',
                                }
                            },
                            {
                                area: 'Aminabad',
                                name: 'Shop No. 402',
                                location: '402 Main Bazaar, Aminabad',
                                dimensions: '150 sq ft',
                                images: [
                                    'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj26B-laUIWVx_qyUp2qF66vfdJDnL16_-oZsAaKqQctJp7VMYB-wF0t1Lf1u_HOZhQIE09gBWrZ9-4vndUypWi36VNaCdrSUZpZTfPaFcYD5FDCNMB0W4H7rsUuZ3stJlR9DbPu5mTRkoj/s1600/13781729_1222710774428574_764609903607950642_n.jpg'
                                ],
                                other_details: {
                                    type: 'Retail Shop',
                                    status: 'vacant',
                                }
                            },
                            {
                                area: 'Aminabad',
                                name: 'Shop No. 403',
                                location: '403 Main Bazaar, Aminabad',
                                dimensions: '120 sq ft',
                                images: [
                                    'https://www.nowlucknow.com/wp-content/uploads/2018/04/Karamat-1-1024x683.jpg'
                                ],
                                other_details: {
                                    type: 'Retail Shop',
                                    status: 'vacant',
                                }
                            },
                            {
                                area: 'Aminabad',
                                name: 'Shop No. 404',
                                location: '404 Main Bazaar, Aminabad',
                                dimensions: '180 sq ft',
                                images: [
                                    'https://content.jdmagicbox.com/v2/comp/delhi/84/011pg025984/catalogue/new-gaurav-watch-co-lajpat-nagar-2-delhi-wrist-watch-repair-and-services-sv2p2zo44o.jpg'
                                ],
                                other_details: {
                                    type: 'Retail Shop',
                                    status: 'vacant',
                                }
                            },
                            {
                                area: 'Malak',
                                name: 'Khasra No. 9666',
                                location: '789 Pine Road, Lakeside',
                                dimensions: '1,500 sq ft',
                                images: [
                                    'https://5.imimg.com/data5/SELLER/Default/2022/6/PY/XW/GM/143012748/9d46f98d-0ac3-43e9-9687-ceaefe0c2e5a-500x500.jpg'
                                ],
                                other_details: {
                                    bedrooms: 2,
                                    bathrooms: 1,
                                    amenities: 'Private dock, Fire pit',
                                }
                            },
                            {
                                area: 'Malak',
                                name: 'Khasra No. 9667',
                                location: '101 Oak Lane, The Countryside',
                                dimensions: '3,000 sq ft',
                                images: [
                                    'https://rei.wlimg.com/prop_images/2468809/1152018_2.jpg',
                                    'https://images.unsplash.com/photo-1508738362670-65476a6d6349?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                                ],
                                other_details: {
                                    bedrooms: 4,
                                    bathrooms: 2,
                                    amenities: 'Large garden, Barn, Ample parking',
                                }
                            },
                            {
                                area: 'Malak',
                                name: 'Khasra No. 9665',
                                location: '123 Forest View, Malak',
                                dimensions: '1,800 sq ft',
                                images: [
                                    'https://housing-images.n7net.in/01c16c28/7f5cd1af1e09e584ae20e8f6aca7d607/v0/medium/residential_plot-for-sale-lakshvar_vajaha-Lucknow-plot_view.jpg'
                                ],
                                other_details: {
                                    bedrooms: 3,
                                    bathrooms: 2,
                                    amenities: 'Large lot, Private garden',
                                }
                            },
                            {
                                area: 'Sarojini Nagar',
                                name: 'Near Neem Ka Ped',
                                location: '404 Ocean Drive, Sunny Shores',
                                dimensions: '1,200 sq ft',
                                images: [
                                    'https://i0.wp.com/solarvillageproject.org/wp-content/uploads/2023/03/scroling-pic2-9-scaled.jpg?ssl=1',
                                    'https://images.unsplash.com/photo-1588698943797-17e9447387c2?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                                ],
                                other_details: {
                                    bedrooms: 2,
                                    bathrooms: 2,
                                    amenities: 'Direct beach access, Patio, Fully furnished',
                                }
                            },
                             {
                                area: 'Sarojini Nagar',
                                name: 'Near Aam Ka Pedh',
                                location: '123 Pinecrest Lane, Mountainville',
                                dimensions: '1,000 sq ft',
                                images: [
                                    'https://i0.wp.com/solarvillageproject.org/wp-content/uploads/2023/03/scroling-pic2-9-scaled.jpg?ssl=1',
                                    'https://images.unsplash.com/photo-1528659837941-865611736b72?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                                ],
                                other_details: {
                                    bedrooms: 2,
                                    bathrooms: 1,
                                    amenities: 'Scenic views, Fireplace, Hot tub',
                                }
                            },
                        ];
                        
                        for (const prop of properties) {
                            // The `addDoc` function adds a new document with an auto-generated ID.
                            await addDoc(collectionRef, prop);
                        }
                        console.log("Placeholder data added successfully.");
                    } else {
                        console.log("Placeholder data already exists in Firestore.");
                    }
                } else {
                    console.log("Skipping placeholder data addition in mock mode.");
                }
            } catch (error) {
                console.error("Error adding placeholder data:", error);
            }
        };

    </script>
</body>
</html>
